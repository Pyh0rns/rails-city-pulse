<%# 1 div container pour toute la page  %>
  <div>
    <%= link_to city_pulses_path(current_user.city), class:"linkto" do %>
      <p class="linkto"><i class="fas fa-arrow-left mb-3"> </i> Pulses de ta ville</p>
    <% end %>
  </div>
<div class="container">

  <%# 2 div du profil en haut de la page  %>
  <div class="profile-card d-flex justify-content-between mt-5 p-4">

  <%# 3 div a gauche avec nom grade et ville %>
    <div class="w-50">
      <img class="avatar-large-profile" src="<%= current_user.photo_url %>" alt="">
      <div class="profile-card-left">
        <h1><%= current_user.nickname %></h1>
        <h2>Ville: <%= current_user.city.name %></h2>
        <h2>Grade: <%= current_user.level %></h2>
        <h2>XP: <%= current_user.experience %></h2>
      </div>
    </div>

  <%# 4 div a droite avec nom thÃ©matiques et bio %>
    <div class="w-50">
      <h2>Principales thÃ©matiques:
      <% current_user.pulses.each do |pulse|%>
        <%= sanitize pulse.categories.group_by {|category| category.image}.keys[0]%>
      <%end%>
      </h2>

      <h2>Bio: </h2>
      <p><%= current_user.bio %> </p>
    </div>
  <%# fin div 2 %>
  </div>
</div>

<%# 5 div Ã©changes mairie et meilleurs pulses %>
  <div class="profile-card-bottom">

<%# 6 div meilleurs pulses %>
    <div>
      <h2>Tes meilleurs Pulses</h2>
      <div class="profile-meilleurs-pulses">
        <% unless current_user.pulses.nil? %>
          <% if current_user.pulses.length == 1 %>
            <% limit = 1 %>
          <% elsif current_user.pulses.length == 2 %>
            <% limit = 2 %>
          <% else %>
            <% limit = 3 %>
          <% end %>
          <% top2 = current_user.pulses.limit(limit).sort_by { |pulse| pulse.favorites.count } %>
          <% top2.reverse.each do |top| %>
            <div class="pulses-profile d-flex">
                <div class='m-3 fs-3'>
                  <% top.categories.each do |category| %>
                    <%= sanitize category.image %>
                  <% end %>
                </div>
                <div class="pulse-profile-description">
                  <h3><%= top.title %> : <%= top.favorites.length %> ðŸ’™ </h3>
                  <p><%= top.solution %></p>
                </div>
            </div>
          <% end %>
        <% end %>
      </div>
    </div>


<%# 7 div Ã©changes mairie %>
<%# --------------------- FAKE, a changer !! -------------------- %>
<div class='d-block'>
  <h2>Tes Ã©changes dernier avec la Mairie</h2>
  <div>
      <% @messages.each do |message|%>
        <%= link_to 'Open', profile_path(current_user, chatroom_id: message.chatroom.id) %>
        <%= link_to 'Close', profile_path(current_user) %>
      <%end %>
  </div>

  <div class="echange-mairie">
    <% if @chatroom %>
      <div class="container chatroom container-chatroom mb-3" data-controller="chatroom-subscription"
        data-chatroom-subscription-chatroom-id-value="<%= @chatroom.id %>">
        <h2>#<%= @chatroom.name %></h2>
          <div class="messages" data-chatroom-subscription-target="messages">
            <% @chatroom.messages.each do |message| %>
            <%= render "messages/message", message: message %>
            <% end %>
          </div>
          <%= simple_form_for [@chatroom, @message],
            remote: true,
            html: {data: {chatroom_subscription_target: "form"}, class: "d-block"} do |f| %>
              <%= f.input :content,
                label: false,
                placeholder: "Message Ã  votre Mairie",
                wrapper_html: {class: "flex-grow-1 input-profile-message"} %>
              <button><%= f.submit "Send", class: "profile" %></button>
            <%end%>
        </div>
    <%end%>
  </div>
</div>
<%# fin div 5 %>
  </div>

<%# 7 div derniers pulses postÃ©s et aimÃ©s %>
  <div class="profile-card-bottom d-flex justify-content-between border p-3 m-5">

<%# 8 div derniers pulses postÃ©s %>
    <div class="w-50 m-3">
      <h2>Tes derniers Pulses postÃ©s</h2>
      <div class="pulses-profile border p-2 mb-2">
        <% unless current_user.pulses[-1].blank? %>
          <h3><%= current_user.pulses[-1].title %>, le <%= current_user.pulses[-1].created_at.strftime("%d/%m/%Y") %> </h3>
          <p><%= current_user.pulses[-1].solution %></p>
        <% end %>
      </div>
      <div class="pulses-profile border p-2 mb-2">
        <% unless current_user.pulses[-2].blank? %>
          <h3> <%= current_user.pulses[-2].title %>, le <%= current_user.pulses[-2].created_at.strftime("%d/%m/%Y") %> </h3>
          <p><%= current_user.pulses[-2].solution %></p>
        <% end %>
      </div>
      <div class="pulses-profile border p-2 mb-2">
        <% unless current_user.pulses[-3].blank? %>
          <h3> <%= current_user.pulses[-3].title %>, le <%= current_user.pulses[-3].created_at.strftime("PulsÃ© le %d/%m/%Y") %></h3>
          <p><%= current_user.pulses[-3].solution %></p>
        <% end %>
      </div>
    </div>

<%# 9 div derniers pulses aimÃ©s %>
    <div class="w-50 m-3">
      <h2>Tes derniers Pulses aimÃ©s</h2>
      <div class="pulses-profile border p-2 mb-2">
        <% unless current_user.favorites[-1].nil? %>
          <h3><%= current_user.favorites[-1].pulse.title %>,
            par <%= current_user.favorites[-1].pulse.user.nickname %>
            de <%= current_user.favorites[-1].pulse.user.city.name %>,
            le <%= current_user.favorites[-1].pulse.created_at.strftime("%d/%m/%Y") %></h3>
          <p><%= current_user.favorites[-1].pulse.solution %></p>
        <% end %>
      </div>
      <div class="pulses-profile border p-2 mb-2">
        <% unless current_user.favorites[-2].nil? %>
          <h3><%= current_user.favorites[-2].pulse.title %>,
            par <%= current_user.favorites[-2].pulse.user.nickname %>
            de <%= current_user.favorites[-2].pulse.user.city.name %>,
            le <%= current_user.favorites[-1].pulse.created_at.strftime("%d/%m/%Y") %></h3>
          <p><%= current_user.favorites[-2].pulse.solution %></p>
        <% end %>
      </div>
      <div class="pulses-profile border p-2 mb-2">
        <% unless current_user.favorites[-3].nil? %>
          <h3><%= current_user.favorites[-3].pulse.title %>,
            par <%= current_user.favorites[-3].pulse.user.nickname %>
            de <%= current_user.favorites[-3].pulse.user.city.name %>,
            le <%= current_user.favorites[-1].pulse.created_at.strftime("%d/%m/%Y") %></h3>
          <p><%= current_user.favorites[-3].pulse.solution %></p>
        <% end %>
      </div>
    </div>
<%# fin div 7 %>
  </div>

<%# fin div 1 %>
