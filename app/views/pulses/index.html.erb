<%# ================= GEOCODER ================= %>
<div id="map">
  <div style="width: 100%; height: 600px;"
    data-controller="mapbox"
    data-mapbox-markers-value="<%= @markers.to_json %>"
    data-mapbox-api-key-value="<%= ENV['MAPBOX_API_KEY'] %>">
    </div>
</div>
<div class="container">
<%# ================= NAVIGATION ================= %>
<div class="navigation">
<%# ================= SEARCHBAR ================= %>
  <%= form_tag city_pulses_path(current_user.city.id), method: :get do %>
    <%= text_field_tag :query,
      params[:query],
      class: "form-control",
      placeholder: "Trouve un Pulse ou un utilisateur"
    %>
    <%= submit_tag "Search", class: "btn btn-primary" %>
  <% end %>
  <%= link_to 'Pulse ton idée', new_city_pulse_path%>
</div>

  <%# ================= CARDS ================= %>
  <div class='card-pulse-container'>
    <% @pulses.each do |pulse| %>
      <div class="card-pulse">
        <img class="avatar" src="<%= pulse.user.photo_url %>" alt="">
        <img id= "card-pulse-img" src= '<%= pulse.photo_url%>'/>
        <div class="card-pulse-infos">
          <div>
            <h2><%= pulse.title %></h2>
            <p> <%= pulse.problem %></p>
            <p><%= pulse.user.nickname %></p>
          </div>
          <h2 class="card-pulse-votes"> <%= pulse.favorites.length %> votes</h2>
          <%# ajouter des faux votes pour faire grossir les chiffres %>


<%# ----------------------- favorites ----------------------------------- %>

          <% if pulse.liked?(current_user)%>
            <%= link_to favorite_path(pulse.favorites.find_by(user_id: current_user).id, city_id: current_user.city), method: :delete do %>
              <button class="button-like-red"><i class="fas fa-heartbeat"></i></button>
            <% end %>
          <% else %>
            <%= link_to pulse_favorites_path(pulse, city_id: current_user.city), remote: true, method: :post do %>
              <button class="button-like-blue"><i class="fas fa-heartbeat"></i></button>
            <% end %>
          <% end %>
          <%# <img src="https://kitt.lewagon.com/placeholder/users/krokrob" class="card-trip-user avatar-bordered" /> %>
        </div>
      </div>
    <% end %>
  </div>

  <%= link_to 'Pulse ton idée', new_city_pulse_path%>
</div>

<%# favorite DELETE /favorites/:id(.:format)         favorites#destroy %>
