<%# ================= GEOCODER ================= %>
<div id="map">
  <div style="width: 100%; height: 600px;"
    data-controller="mapbox"
    data-mapbox-markers-value="<%= @markers.to_json %>"
    data-mapbox-api-key-value="<%= ENV['MAPBOX_API_KEY'] %>">
    </div>
</div>

<div class='p-5'>
  <%# ================= NAVIGATION ================= %>
  <div class="navigation d-flex align-items-center">
  <%= link_to root_path, class:"button-back d-flex mx-5" do %>
    <i class="fas fa-arrow-left">Return Home</i>
  <% end %>

    <%# ----------- searchbar -------- %>
    <div class = "searchbarindex">
      <%= form_tag city_pulses_path(@city), method: :get do %>
        <%= text_field_tag :query,
          params[:query],
          class: "form-control",
          placeholder: "Trouve un Pulse ou un utilisateur"%>
        <%= submit_tag "Search", class: "btn btn-primary" %>
      <% end %>
    </div>
    <%# ----------- link to form new -------- %>
    <% if current_user.city == @city %>
      <%= link_to 'Pulse ton idée', new_city_pulse_path, class:"button-pulse-red"%>
    <% end %>
  </div>
</div>

<div class="container" data-controller="filter">
  <div class="d-flex justify-content-between mb-5">
  <button data-action="click->filter#order">Plus likés</button>
  <button data-action="click->filter#order">Catégories</button>
  <button data-action="click->filter#order">Réalisés</button>
</div>


  <%# ================= CARDS ================= %>
  <div class='card-pulse-container mb-5'data-filter-target='container'>
      <% @pulses.each do |pulse| %>
        <div class="card-pulse" data-filter-target='card' data-votes=<%= pulse.favorites.length %>>
        <img class="avatar" src="<%= pulse.user.photo_url %>" alt="">
            <img id= "card-pulse-img" src= <%=pulse.photo_url.nil? ? 'https://source.unsplash.com/random' : pulse.photo_url%>/>
          <div class="card-pulse-infos">
            <div class='mb-3 mt-2'>
              <%= link_to city_pulse_path(@city, pulse), class:"text-decoration-none" do %>
               <h2><%= pulse.title %> <i class="fas fa-theater-masks"></i> </h2>
              <% end %>
            </div>
            <div class='d-flex'>
              <div>
                <p> <%= pulse.problem %></p>
              </div>
              <div class="card-pulse-votes" data-filter-target='votes'><%= pulse.favorites.length %>likes</div>
            </div>
          <%# ------- favorites ----------- %>
          <% if pulse.liked?(current_user)%>
            <%= link_to favorite_path(pulse.favorites.find_by(user_id: current_user).id, city_id: current_user.city), method: :delete do %>
              <button class="button-like-red"><i class="fas fa-heartbeat"></i></button>
            <% end %>
          <% else %>
            <%= link_to pulse_favorites_path(pulse, city_id: @city), remote: true, method: :post do %>
              <button class="button-like-blue"><i class="fas fa-heartbeat"></i></button>
            <% end %>
          <% end %>
          <%# <img src="https://kitt.lewagon.com/placeholder/users/krokrob" class="card-trip-user avatar-bordered" /> %>
        </div>
      </div>
    <% end %>
  </div>
</div>
